<configuration xmlns:patch="http://www.sitecore.net/xmlconfig/">
  <sitecore>

    <pipelines>

      <sessionEnd>
        <processor patch:before="Sitecore.Pipelines.SessionEnd.SaveRecentDocuments" type="PersistAnalyticsData.StoreProfiles,PersistAnalyticsData"/>
      </sessionEnd>

      <createVisit>
        <processor patch:after="*[@type='Sitecore.Analytics.Pipelines.CreateVisits.SetTrafficType,Sitecore.Analytics']" type="PersistAnalyticsData.LoadProfiles,PersistAnalyticsData"/>
      </createVisit>

    </pipelines>

    <model>
      <elements>
        <element interface="PersistAnalyticsData.IProfilingStorage,PersistAnalyticsData" implementation="PersistAnalyticsData.ProfilingStorage,PersistAnalyticsData"/>
        <element interface="PersistAnalyticsData.IProfile,PersistAnalyticsData" implementation="PersistAnalyticsData.Profile,PersistAnalyticsData"/>
        <element interface="PersistAnalyticsData.IProfileKey,PersistAnalyticsData" implementation="PersistAnalyticsData.ProfileKey,PersistAnalyticsData"/>
      </elements>
      <entities>
        <contact>
          <facets>
            <facet name="profiling" contract="PersistAnalyticsData.IProfilingStorage,PersistAnalyticsData"></facet>
          </facets>
        </contact>
      </entities>
    </model>


  </sitecore>
</configuration>
